{% extends "base.html" %}
{% block title %}Your Orders{% endblock title %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center text-info mb-5" style="font-family: 'Poppins', sans-serif; font-weight: bold;">Your Orders</h2>

    {% for order in orders %}
        <div class="order-item mb-4 p-4 border rounded-lg shadow-lg" style="background-color: #ffffff; border-left: 6px solid #3498db; transition: all 0.3s ease;">
            <h5 class="text-dark" style="font-family: 'Arial', sans-serif; font-weight: 600; font-size: 1.2rem; margin-bottom: 10px;">{{ order.product.name }}</h5>
            <p><strong class="text-primary">Order Date:</strong> <span class="text-muted">{{ order.order_date }}</span></p>
            <p><strong class="text-primary">Status:</strong> 
                {% if order.is_paid %}
                    <span class="badge badge-success">Paid</span>
                {% else %}
                    <span class="badge badge-warning">Pending</span>
                {% endif %}
            </p>

            {% if not order.is_paid %}
                <form method="POST" action="{% url 'process_payment' order.id %}" class="mb-3">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm" style="border-radius: 25px; padding: 10px 20px; background-color: #28a745; border: none; font-size: 14px;">Make Payment</button>
                </form>
            {% endif %}

            <!-- Buttons Layout with spacing -->
            <div class="d-flex justify-content-between mt-3">
                <button class="btn btn-danger btn-sm" id="deleteBtn{{ order.id }}" onclick="startTimer({{ order.id }})" style="border-radius: 25px; padding: 10px 20px; background-color: #e74c3c; border: none; font-size: 14px;">
                    Delete Order
                </button>

                <p class="timer mt-3 mb-0" id="timer{{ order.id }}" style="font-weight: bold; color: #e74c3c; font-size: 14px;">Time left to delete: 1:00:00</p>
            </div>
        </div>
    {% endfor %}
</div>

<script>
    // Timer Logic - Starts as soon as the order is placed
    function startTimer(orderId) {
        let timer = 3600; // 1 hour in seconds
        const timerDisplay = document.getElementById('timer' + orderId);
        const deleteBtn = document.getElementById('deleteBtn' + orderId);

        const countdown = setInterval(() => {
            let hours = Math.floor(timer / 3600);
            let minutes = Math.floor((timer % 3600) / 60);
            let seconds = timer % 60;

            // Update the timer display
            timerDisplay.textContent = `Time left to delete: ${hours}:${minutes}:${seconds}`;
            timer--;

            if (timer < 0) {
                clearInterval(countdown);
                deleteBtn.style.display = 'none';
                timerDisplay.textContent = 'Delete option has expired.';
            }
        }, 1000);
    }

    // Initialize the timer when the page loads for each order
    document.addEventListener('DOMContentLoaded', function() {
        {% for order in orders %}
            startTimer({{ order.id }});
        {% endfor %}
    });
</script>

{% endblock body %}
